library(ozib)
library(tidyverse)
library(betabart)
library(SoftBart)

install.packages("zoib")



betabart_data <- list(
  Y = y,
  Ydivided = betabart::prepare.response(y),
  X = SoftBart::quantile_normalize_bart(sampleX)
)

hypers <- ozib::Hypers(X = betabart_data$X, Y = betabart_data$Y,
                       W = betabart_data$X,
                       delta1 = betabart_data$Ydivided$y1,
                       delta0 = betabart_data$Ydivided$y0)
opts   <- Opts()
opts$approximate_density <- TRUE

time <- Sys.time()
fit <- betabart(X = betabart_data$X, Y = betabart_data$Y,
                delta1 = betabart_data$Ydivided$y1,
                delta0 = betabart_data$Ydivided$y0,
                yb = betabart_data$Ydivided$yb,
                X_test = betabart_data$X,
                hypers_ = hypers, opts_ = opts)
print(duration <- Sys.time() - time)

saveRDS(list(y = betabart_data$Y, x = betabart_data$X, fit = fit, time = duration),
        file.path(paste0("fit.rds")))

